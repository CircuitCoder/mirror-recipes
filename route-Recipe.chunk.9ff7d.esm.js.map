{"version":3,"sources":["webpack:///./routes/Recipe.scss","webpack:///./assets/presets sync nonrecursive .ya","webpack:///./components/PresetSelect.scss","webpack:///./components/PresetSelect.tsx","webpack:////home/runner/work/mirror-recipes/mirror-recipes/web/renderer/src/util.ts","webpack:///./util.ts","webpack:////home/runner/work/mirror-recipes/mirror-recipes/web/renderer/src/step.tsx","webpack:////home/runner/work/mirror-recipes/mirror-recipes/web/renderer/src/renderer.tsx","webpack:////home/runner/work/mirror-recipes/mirror-recipes/web/renderer/src/index.ts","webpack:///./routes/Recipe.tsx","webpack:///./assets/data.ts","webpack:///./assets/recipes sync nonrecursive .ya"],"names":["module","exports","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","map","e","Error","code","keys","Object","resolve","PresetSelect","state","dispatch","useContext","Ctx","class","style","select","value","site","onChange","type","currentTarget","PRESETS","k","key","expand","_val","params","val","regex","match","modifications","exec","dependency","push","index","lastIndex","reverse","f","t","v","substr","resolvePreset","preset","recipe","lookup","presets","fullExpansion","set","_from","_counter","_stash","length","counter","Set","stash","Map","from","find","has","Array","entries","reduce","acc","console","log","add","get","delete","undefined","shared","Step","step","number","cont","with","replace","append","run","manually","Renderer","input","setInput","useState","joined","useMemo","defaults","default","filter","single","pv","isArray","tuple","param","valid","includes","RegExp","fixed","changable","every","proc","procedures","when","inputArea","disabled","selected","placeholder","onInput","copied","hint","description","steps","do","idx","Recipe","RECIPES","resolved","container","breadcrumb","href","title","sep","getName","fn","recipesCtx","require","presetsCtx","cur"],"mappings":"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","file":"route-Recipe.chunk.9ff7d.esm.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"container__1bdtp\",\"title\":\"title__3q31p\",\"title-row\":\"title-row__395Ks\",\"sep\":\"sep__zj3cc\",\"hint\":\"hint__2xB8n\",\"breadcrumb\":\"breadcrumb__2SMJD\",\"preset\":\"preset__1iX0X\"};","var map = {\n\t\"./TUNA.yaml\": \"Ta76\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"Mauj\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"select\":\"select__1gF0M\"};","import { FunctionalComponent, h, Fragment } from \"preact\";\nimport { useContext } from \"preact/hooks\";\nimport { Ctx } from './App';\nimport { PRESETS } from \"../assets/data\";\nimport style from './PresetSelect.scss';\n\nconst PresetSelect: FunctionalComponent = () => {\n  const { state, dispatch } = useContext(Ctx);\n\n  return (\n    <select\n      class={style.select}\n      value={state.site ?? \"__unset__\"}\n      onChange={(e) =>\n        dispatch({\n          type: \"SetSite\",\n          site:\n            e.currentTarget.value === \"__unset__\"\n              ? null\n              : e.currentTarget.value,\n        })\n      }\n    >\n      <option value=\"__unset__\">Unset</option>\n      <optgroup>\n        {Object.keys(PRESETS).map((k) => (\n          <option value={k} key={k}>\n            {k}\n          </option>\n        ))}\n      </optgroup>\n    </select>\n  )\n};\n\nexport default PresetSelect;","export function expand(_val: string, params: Record<string, string>): string {\n  let val = _val;\n  const regex = /\\{ *([A-Z0-9_]+) *\\}/g;\n  let match: RegExpExecArray | null;\n  const modifications: [number, number, string][] = [];\n  while((match = regex.exec(val)) !== null) {\n    const dependency = match[1];\n    modifications.push([\n      match.index,\n      regex.lastIndex,\n      params[dependency] ?? `[${dependency}]`,\n    ]);\n  }\n\n  modifications.reverse();\n  for(const [f, t, v] of modifications)\n    val = val.substr(0, f) + v + val.substr(t);\n\n  return val;\n}","export function resolvePreset(preset: Record<string, any>, recipe: string): Record<string, string> {\n  const lookup = preset.presets[recipe];\n  if(!lookup) return {};\n\n  // Do recursive expansion\n  const all = {\n    ...preset.shared,\n    ...lookup,\n  };\n\n  return fullExpansion(all);\n}\n\nfunction fullExpansion(set: Record<string, string>, _from?: string, _counter?: Set<string>, _stash?: Map<string, string>): Record<string, string> {\n  if(Object.keys(set).length === 0) return {};\n\n  let counter: Set<string> = _counter ?? new Set();\n  let stash: Map<string, string> = _stash ?? new Map();\n  let from = _from ?? Object.keys(set).find(k => !stash.has(k));\n\n  if(!from) return {\n    ...Array.from(stash.entries()).reduce(\n      (acc, [k, v]) => ({ ...acc, [k]: v }),\n      {}\n    ),\n  };\n\n  console.log(`Resolving ${from}`);\n\n  if(counter.has(from)) throw new Error(`Recursive expansion in param set at ${from}`);\n  counter.add(from);\n\n  let val = set[from];\n  const regex = /\\{ *([A-Z0-9_]+) *\\}/g;\n  let match: RegExpExecArray | null;\n  const modifications: [number, number, string][] = [];\n  while((match = regex.exec(val)) !== null) {\n    const dependency = match[1];\n    if(!stash.has(dependency)) fullExpansion(set, dependency, counter, stash);\n    modifications.push([\n      match.index,\n      regex.lastIndex,\n      stash.get(dependency) ?? '__RESOLUTION_FAILED__',\n    ]);\n  }\n\n  modifications.reverse();\n  for(const [f, t, v] of modifications)\n    val = val.substr(0, f) + v + val.substr(t);\n\n  counter.delete(from);\n\n  stash.set(from, val);\n\n  console.log(`Current stash`, stash);\n\n  // Continue to find next unresolved key\n  return fullExpansion(set, undefined, counter, stash);\n}","import { FunctionalComponent, h, Fragment, JSX } from \"preact\";\nimport { useMemo, useState } from \"preact/hooks\";\nimport { expand } from './util';\n\ntype Params = {\n  step: Record<string, any>;\n  params: Record<string, string>;\n  number: JSX.Element;\n};\n\nconst Step: FunctionalComponent<Params> = ({ step, params, number }: Params) => {\n  console.log(step);\n  if('append' in step || 'replace' in step) {\n    const cont = expand(step.with, params);\n\n    return <div class={`mr-step mr-step-${'append' in step ? 'append' : 'replace'}`}>\n      <div class=\"mr-step-header\">\n        {number}\n        <div class=\"mr-step-op\">{'append' in step ? 'Append to file' : 'Replace file'}</div>\n      </div>\n\n      <div class=\"mr-step-path\">{step.replace ?? step.append}</div>\n\n      <pre class=\"mr-step-file\">{cont}</pre>\n    </div>\n  } else if('run' in step) {\n    const cont = expand(step.run, params);\n\n    return <div class={'mr-step mr-step-run'}>\n      <div class=\"mr-step-header\">\n        {number}\n        <div class=\"mr-step-op\">Run script</div>\n      </div>\n\n      {step.with && <div class=\"mr-step-executor\">{step.with}</div> }\n\n      <pre class=\"mr-step-script\">{cont}</pre>\n    </div>\n  } else if('manually' in step) {\n    const cont = expand(step.manually, params);\n\n    return <div class={'mr-step mr-step-run'}>\n      <div class=\"mr-step-header\">\n        {number}\n        <div class=\"mr-step-op\">Manually do</div>\n      </div>\n\n      <pre class=\"mr-step-manually\">{cont}</pre>\n    </div>\n  }\n\n  return null;\n};\n\nexport default Step;","import { FunctionalComponent, h, Fragment } from \"preact\";\nimport { useMemo, useState } from \"preact/hooks\";\nimport Step from './step';\n\ntype Params = {\n  recipe: Record<string, any>;\n  params: Record<string, string>;\n};\n\nconst Renderer: FunctionalComponent<Params> = ({ recipe, params }: Params) => {\n  const [input, setInput] = useState<Record<string, string>>({})\n  const joined = useMemo(() => {\n    // Default\n    const defaults: Record<string, string> = Object.keys(recipe.params)\n      .map((key) => [key, recipe.params[key].default])\n      .filter((e) => !!e[1])\n      .reduce((acc, [key, val]) => ({ ...acc, [key]: val }), {});\n\n    // Single possibility\n    const single: Record<string, string> = Object.keys(recipe.params)\n      .filter((key) => {\n        let pv = recipe.params[key]['possible-value']\n        return Array.isArray(pv) && pv.length === 1;\n      })\n      .map((key) => [key, recipe.params[key]['possible-value'][0]])\n      .reduce((acc, [key, val]) => ({ ...acc, [key]: val }), {});\n    \n    return {\n      ...defaults,\n      ...single,\n      ...input,\n      ...params,\n    } as Record<string, string>;\n\n  }, [input, recipe.params, params]);\n\n  const tuple = Object.keys(recipe.params).map(key => {\n    const param = recipe.params[key];\n    const match = param['possible-value'];\n    let valid = false;\n\n    if(!joined[key]) valid = !!param.default;\n    else {\n      if(Array.isArray(match)) valid = match.includes(joined[key]);\n      else if(typeof match === 'string') {\n        const regex = new RegExp(match);\n        valid = !!joined[key].match(regex);\n      }\n      else valid = true;\n    }\n\n    const fixed = Array.isArray(match) && match.length === 1;\n\n    return {\n      key,\n      param,\n\n      input: input[key],\n      value: joined[key],\n\n      valid,\n      fixed,\n    };\n  });\n\n  const changable = tuple.filter(e => !(e.key in params) && !e.fixed);\n\n  const valid = tuple.every(e => e.valid);\n  // Procedure select\n  const proc = recipe.procedures.find((e: Record<string, any>) => {\n    if(!e.when) return true;\n    for(const key in e.when)\n      if(e.when[key] !== joined[key]) return false;\n    return true;\n  });\n\n  return (\n    <Fragment>\n      {changable.map(({ key, param, input, valid }) => {\n        let inputArea;\n        const pv = param[\"possible-value\"];\n        if (Array.isArray(pv))\n          inputArea = (\n            <select\n              value={input}\n              class=\"mr-param-select\"\n              onChange={(e) => {\n                setInput((input) => ({\n                  ...input,\n                  [key]: e.currentTarget.value,\n                }));\n              }}\n            >\n              <option disabled default selected>\n                Please select\n              </option>\n              {pv.map((value) => (\n                <option key={value} value={value}>\n                  {value}\n                </option>\n              ))}\n            </select>\n          );\n        else\n          inputArea = (\n            <input\n              placeholder={param.default}\n              value={input}\n              class=\"mr-param-input\"\n              onInput={(e) => {\n                const val = e.currentTarget.value;\n                console.log(val);\n                setInput((input) => {\n                  if (val !== \"\") return { ...input, [key]: val };\n                  const copied = { ...input };\n                  delete copied[key];\n                  return copied;\n                });\n              }}\n            ></input>\n          );\n\n        let hint = [];\n        if (param[\"obtained-by\"])\n          hint.push(\n            <div class=\"mr-hint\">\n              Try execute <code>{param[\"obtained-by\"]}</code>\n            </div>\n          );\n        if (typeof pv === \"string\")\n          hint.push(\n            <div class=\"mr-hint\">\n              Should match <code>{pv}</code>\n            </div>\n          );\n\n        return (\n          <div class=\"mr-param\">\n            <div class=\"mr-param-title\">{key}</div>\n            <div class=\"mr-param-desc\">{param.description}</div>\n            {inputArea}\n            {hint}\n          </div>\n        );\n      })}\n\n      {valid && <div class=\"mr-sep\" />}\n\n      {valid &&\n        (proc ? (\n          proc.steps\n            .map((e: Record<string, any>) => {\n              if (e.do) return recipe.steps[e.do];\n              else return e;\n            })\n            .map((e: Record<string, any>, idx: number) => (\n              <Step\n                step={e}\n                params={joined}\n                number={\n                  <div class=\"mr-step-number\">\n                    <span class=\"mr-step-number-hint\">Step</span>\n                    {idx + 1}/{proc.steps.length}\n                  </div>\n                }\n              />\n            ))\n        ) : (\n          <div class=\"mr-failed\">No applicable procedure found</div>\n        ))}\n    </Fragment>\n  );\n};\n\nexport default Renderer;","import { h } from \"preact\";\nimport Renderer from \"./renderer\";\n\nexport default Renderer;\n","import { FunctionalComponent, h, Fragment } from \"preact\";\nimport { PRESETS, RECIPES } from '../assets/data';\nimport style from './Recipe.scss';\nimport Renderer from 'mirror-recipes-renderer';\nimport { resolvePreset } from \"../util\";\nimport { useContext } from \"preact/hooks\";\nimport { Ctx } from \"../components/App\";\nimport PresetSelect from \"../components/PresetSelect\";\nimport { Link } from \"preact-router\";\n\ntype Params = {\n  id: string,\n};\n\nconst Recipe: FunctionalComponent<Params> = ({ id }: Params) => {\n  const recipe = RECIPES[id];\n  const { state, dispatch } = useContext(Ctx);\n  const preset = state.site ? (PRESETS[state.site] ?? null) : null;\n  const resolved = preset ? resolvePreset(preset, id) : {};\n\n  return (\n    <Fragment>\n      <div class={style.container}>\n        <div class={style.breadcrumb}>\n          <Link href=\"/\">mirror-recipes</Link>\n          <Link href=\"/recipe\">List</Link>\n        </div>\n\n        <div class={style[\"title-row\"]}>\n          <div class={style.title}>{id}</div>\n          <div class={style.sep}>/</div>\n          <div class={style.preset}>\n            <div class={style.hint}>Preset</div>\n            <PresetSelect />\n          </div>\n        </div>\n\n        <Renderer\n          recipe={recipe}\n          params={resolved}\n        ></Renderer>\n      </div>\n    </Fragment>\n  );\n};\n\nexport default Recipe;\n","const recipesCtx = require.context('./recipes', false, /.ya?ml$/);\nconst presetsCtx = require.context('./presets', false, /.ya?ml$/);\n\nfunction getName(fn: string): string {\n  return fn.match(/\\/(.*).ya?ml$/)?.[1] ?? '';\n}\n\nexport const RECIPES: Record<string, Record<string, any>> = recipesCtx\n  .keys()\n  .reduce((acc, cur) => ({ ...acc, [getName(cur)]: recipesCtx(cur) }), {});\n\nexport const PRESETS: Record<string, Record<string, any>> = presetsCtx\n  .keys()\n  .reduce((acc, cur) => ({ ...acc, [getName(cur)]: presetsCtx(cur) }), {});\n","var map = {\n\t\"./AUR.yml\": \"bbHE\",\n\t\"./archlinux.yaml\": \"yFXU\",\n\t\"./ubuntu.yaml\": \"hFeo\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"zBN9\";"],"sourceRoot":""}