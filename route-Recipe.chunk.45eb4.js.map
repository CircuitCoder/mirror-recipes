{"version":3,"sources":["webpack:///./routes/Recipe.scss","webpack:///./assets/presets sync nonrecursive .ya","webpack:///./components/PresetSelect.scss","webpack:///./components/PresetSelect.tsx","webpack:////home/runner/work/mirror-recipes/mirror-recipes/web/renderer/src/util.ts","webpack:///./util.ts","webpack:////home/runner/work/mirror-recipes/mirror-recipes/web/renderer/src/step.tsx","webpack:////home/runner/work/mirror-recipes/mirror-recipes/web/renderer/src/index.ts","webpack:////home/runner/work/mirror-recipes/mirror-recipes/web/renderer/src/renderer.tsx","webpack:///./routes/Recipe.tsx","webpack:///./assets/data.ts","webpack:///./assets/recipes sync nonrecursive .ya"],"names":["module","exports","webpackContext","req","id","webpackContextResolve","__webpack_require__","o","map","e","Error","code","keys","Object","resolve","PresetSelect","useContext","Ctx","state","dispatch","class","style","select","value","site","onChange","type","currentTarget","PRESETS","k","key","expand","_val","params","match","val","regex","modifications","exec","dependency","push","index","lastIndex","reverse","t","v","substr","resolvePreset","preset","recipe","lookup","presets","fullExpansion","set","_from","_counter","_stash","length","counter","Set","stash","Map","from","find","has","Array","entries","reduce","acc","console","log","add","get","delete","undefined","shared","Step","step","number","cont","with","replace","append","run","manually","Renderer","useState","input","setInput","joined","useMemo","defaults","default","filter","single","pv","isArray","tuple","param","valid","includes","RegExp","fixed","changable","every","proc","procedures","when","inputArea","disabled","selected","placeholder","onInput","copied","hint","description","steps","do","idx","Recipe","RECIPES","resolved","container","breadcrumb","href","title","sep","getName","fn","recipesCtx","require","presetsCtx","cur"],"mappings":"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","file":"route-Recipe.chunk.45eb4.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"container__1bdtp\",\"title\":\"title__3q31p\",\"title-row\":\"title-row__395Ks\",\"sep\":\"sep__zj3cc\",\"hint\":\"hint__2xB8n\",\"breadcrumb\":\"breadcrumb__2SMJD\",\"preset\":\"preset__1iX0X\"};","var map = {\n\t\"./TUNA.yaml\": \"Ta76\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"Mauj\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"select\":\"select__1gF0M\"};","import { FunctionalComponent, h, Fragment } from \"preact\";\nimport { useContext } from \"preact/hooks\";\nimport { Ctx } from './App';\nimport { PRESETS } from \"../assets/data\";\nimport style from './PresetSelect.scss';\n\nconst PresetSelect: FunctionalComponent = () => {\n  const { state, dispatch } = useContext(Ctx);\n\n  return (\n    <select\n      class={style.select}\n      value={state.site ?? \"__unset__\"}\n      onChange={(e) =>\n        dispatch({\n          type: \"SetSite\",\n          site:\n            e.currentTarget.value === \"__unset__\"\n              ? null\n              : e.currentTarget.value,\n        })\n      }\n    >\n      <option value=\"__unset__\">Unset</option>\n      <optgroup>\n        {Object.keys(PRESETS).map((k) => (\n          <option value={k} key={k}>\n            {k}\n          </option>\n        ))}\n      </optgroup>\n    </select>\n  )\n};\n\nexport default PresetSelect;","export function expand(_val: string, params: Record<string, string>): string {\n  let val = _val;\n  const regex = /\\{ *([A-Z0-9_]+) *\\}/g;\n  let match: RegExpExecArray | null;\n  const modifications: [number, number, string][] = [];\n  while((match = regex.exec(val)) !== null) {\n    const dependency = match[1];\n    modifications.push([\n      match.index,\n      regex.lastIndex,\n      params[dependency] ?? `[${dependency}]`,\n    ]);\n  }\n\n  modifications.reverse();\n  for(const [f, t, v] of modifications)\n    val = val.substr(0, f) + v + val.substr(t);\n\n  return val;\n}","export function resolvePreset(preset: Record<string, any>, recipe: string): Record<string, string> {\n  const lookup = preset.presets[recipe];\n  if(!lookup) return {};\n\n  // Do recursive expansion\n  const all = {\n    ...preset.shared,\n    ...lookup,\n  };\n\n  return fullExpansion(all);\n}\n\nfunction fullExpansion(set: Record<string, string>, _from?: string, _counter?: Set<string>, _stash?: Map<string, string>): Record<string, string> {\n  if(Object.keys(set).length === 0) return {};\n\n  let counter: Set<string> = _counter ?? new Set();\n  let stash: Map<string, string> = _stash ?? new Map();\n  let from = _from ?? Object.keys(set).find(k => !stash.has(k));\n\n  if(!from) return {\n    ...Array.from(stash.entries()).reduce(\n      (acc, [k, v]) => ({ ...acc, [k]: v }),\n      {}\n    ),\n  };\n\n  console.log(`Resolving ${from}`);\n\n  if(counter.has(from)) throw new Error(`Recursive expansion in param set at ${from}`);\n  counter.add(from);\n\n  let val = set[from];\n  const regex = /\\{ *([A-Z0-9_]+) *\\}/g;\n  let match: RegExpExecArray | null;\n  const modifications: [number, number, string][] = [];\n  while((match = regex.exec(val)) !== null) {\n    const dependency = match[1];\n    if(!stash.has(dependency)) fullExpansion(set, dependency, counter, stash);\n    modifications.push([\n      match.index,\n      regex.lastIndex,\n      stash.get(dependency) ?? '__RESOLUTION_FAILED__',\n    ]);\n  }\n\n  modifications.reverse();\n  for(const [f, t, v] of modifications)\n    val = val.substr(0, f) + v + val.substr(t);\n\n  counter.delete(from);\n\n  stash.set(from, val);\n\n  console.log(`Current stash`, stash);\n\n  // Continue to find next unresolved key\n  return fullExpansion(set, undefined, counter, stash);\n}","import { FunctionalComponent, h, Fragment, JSX } from \"preact\";\nimport { useMemo, useState } from \"preact/hooks\";\nimport { expand } from './util';\n\ntype Params = {\n  step: Record<string, any>;\n  params: Record<string, string>;\n  number: JSX.Element;\n};\n\nconst Step: FunctionalComponent<Params> = ({ step, params, number }: Params) => {\n  console.log(step);\n  if('append' in step || 'replace' in step) {\n    const cont = expand(step.with, params);\n\n    return <div class={`mr-step mr-step-${'append' in step ? 'append' : 'replace'}`}>\n      <div class=\"mr-step-header\">\n        {number}\n        <div class=\"mr-step-op\">{'append' in step ? 'Append to file' : 'Replace file'}</div>\n      </div>\n\n      <div class=\"mr-step-path\">{step.replace ?? step.append}</div>\n\n      <pre class=\"mr-step-file\">{cont}</pre>\n    </div>\n  } else if('run' in step) {\n    const cont = expand(step.run, params);\n\n    return <div class={'mr-step mr-step-run'}>\n      <div class=\"mr-step-header\">\n        {number}\n        <div class=\"mr-step-op\">Run script</div>\n      </div>\n\n      {step.with && <div class=\"mr-step-executor\">{step.with}</div> }\n\n      <pre class=\"mr-step-script\">{cont}</pre>\n    </div>\n  } else if('manually' in step) {\n    const cont = expand(step.manually, params);\n\n    return <div class={'mr-step mr-step-run'}>\n      <div class=\"mr-step-header\">\n        {number}\n        <div class=\"mr-step-op\">Manually do</div>\n      </div>\n\n      <pre class=\"mr-step-manually\">{cont}</pre>\n    </div>\n  }\n\n  return null;\n};\n\nexport default Step;","import { h } from \"preact\";\nimport Renderer from \"./renderer\";\n\nexport default Renderer;\n","import { FunctionalComponent, h, Fragment } from \"preact\";\nimport { useMemo, useState } from \"preact/hooks\";\nimport Step from './step';\n\ntype Params = {\n  recipe: Record<string, any>;\n  params: Record<string, string>;\n};\n\nconst Renderer: FunctionalComponent<Params> = ({ recipe, params }: Params) => {\n  const [input, setInput] = useState<Record<string, string>>({})\n  const joined = useMemo(() => {\n    // Default\n    const defaults: Record<string, string> = Object.keys(recipe.params)\n      .map((key) => [key, recipe.params[key].default])\n      .filter((e) => !!e[1])\n      .reduce((acc, [key, val]) => ({ ...acc, [key]: val }), {});\n\n    // Single possibility\n    const single: Record<string, string> = Object.keys(recipe.params)\n      .filter((key) => {\n        let pv = recipe.params[key]['possible-value']\n        return Array.isArray(pv) && pv.length === 1;\n      })\n      .map((key) => [key, recipe.params[key]['possible-value'][0]])\n      .reduce((acc, [key, val]) => ({ ...acc, [key]: val }), {});\n    \n    return {\n      ...defaults,\n      ...single,\n      ...input,\n      ...params,\n    } as Record<string, string>;\n\n  }, [input, recipe.params, params]);\n\n  const tuple = Object.keys(recipe.params).map(key => {\n    const param = recipe.params[key];\n    const match = param['possible-value'];\n    let valid = false;\n\n    if(!joined[key]) valid = !!param.default;\n    else {\n      if(Array.isArray(match)) valid = match.includes(joined[key]);\n      else if(typeof match === 'string') {\n        const regex = new RegExp(match);\n        valid = !!joined[key].match(regex);\n      }\n      else valid = true;\n    }\n\n    const fixed = Array.isArray(match) && match.length === 1;\n\n    return {\n      key,\n      param,\n\n      input: input[key],\n      value: joined[key],\n\n      valid,\n      fixed,\n    };\n  });\n\n  const changable = tuple.filter(e => !(e.key in params) && !e.fixed);\n\n  const valid = tuple.every(e => e.valid);\n  // Procedure select\n  const proc = recipe.procedures.find((e: Record<string, any>) => {\n    if(!e.when) return true;\n    for(const key in e.when)\n      if(e.when[key] !== joined[key]) return false;\n    return true;\n  });\n\n  return (\n    <Fragment>\n      {changable.map(({ key, param, input, valid }) => {\n        let inputArea;\n        const pv = param[\"possible-value\"];\n        if (Array.isArray(pv))\n          inputArea = (\n            <select\n              value={input}\n              class=\"mr-param-select\"\n              onChange={(e) => {\n                setInput((input) => ({\n                  ...input,\n                  [key]: e.currentTarget.value,\n                }));\n              }}\n            >\n              <option disabled default selected>\n                Please select\n              </option>\n              {pv.map((value) => (\n                <option key={value} value={value}>\n                  {value}\n                </option>\n              ))}\n            </select>\n          );\n        else\n          inputArea = (\n            <input\n              placeholder={param.default}\n              value={input}\n              class=\"mr-param-input\"\n              onInput={(e) => {\n                const val = e.currentTarget.value;\n                console.log(val);\n                setInput((input) => {\n                  if (val !== \"\") return { ...input, [key]: val };\n                  const copied = { ...input };\n                  delete copied[key];\n                  return copied;\n                });\n              }}\n            ></input>\n          );\n\n        let hint = [];\n        if (param[\"obtained-by\"])\n          hint.push(\n            <div class=\"mr-hint\">\n              Try execute <code>{param[\"obtained-by\"]}</code>\n            </div>\n          );\n        if (typeof pv === \"string\")\n          hint.push(\n            <div class=\"mr-hint\">\n              Should match <code>{pv}</code>\n            </div>\n          );\n\n        return (\n          <div class=\"mr-param\">\n            <div class=\"mr-param-title\">{key}</div>\n            <div class=\"mr-param-desc\">{param.description}</div>\n            {inputArea}\n            {hint}\n          </div>\n        );\n      })}\n\n      {valid && <div class=\"mr-sep\" />}\n\n      {valid &&\n        (proc ? (\n          proc.steps\n            .map((e: Record<string, any>) => {\n              if (e.do) return recipe.steps[e.do];\n              else return e;\n            })\n            .map((e: Record<string, any>, idx: number) => (\n              <Step\n                step={e}\n                params={joined}\n                number={\n                  <div class=\"mr-step-number\">\n                    <span class=\"mr-step-number-hint\">Step</span>\n                    {idx + 1}/{proc.steps.length}\n                  </div>\n                }\n              />\n            ))\n        ) : (\n          <div class=\"mr-failed\">No applicable procedure found</div>\n        ))}\n    </Fragment>\n  );\n};\n\nexport default Renderer;","import { FunctionalComponent, h, Fragment } from \"preact\";\nimport { PRESETS, RECIPES } from '../assets/data';\nimport style from './Recipe.scss';\nimport Renderer from 'mirror-recipes-renderer';\nimport { resolvePreset } from \"../util\";\nimport { useContext } from \"preact/hooks\";\nimport { Ctx } from \"../components/App\";\nimport PresetSelect from \"../components/PresetSelect\";\nimport { Link } from \"preact-router\";\n\ntype Params = {\n  id: string,\n};\n\nconst Recipe: FunctionalComponent<Params> = ({ id }: Params) => {\n  const recipe = RECIPES[id];\n  const { state, dispatch } = useContext(Ctx);\n  const preset = state.site ? (PRESETS[state.site] ?? null) : null;\n  const resolved = preset ? resolvePreset(preset, id) : {};\n\n  return (\n    <Fragment>\n      <div class={style.container}>\n        <div class={style.breadcrumb}>\n          <Link href=\"/\">mirror-recipes</Link>\n          <Link href=\"/recipe\">List</Link>\n        </div>\n\n        <div class={style[\"title-row\"]}>\n          <div class={style.title}>{id}</div>\n          <div class={style.sep}>/</div>\n          <div class={style.preset}>\n            <div class={style.hint}>Preset</div>\n            <PresetSelect />\n          </div>\n        </div>\n\n        <Renderer\n          recipe={recipe}\n          params={resolved}\n        ></Renderer>\n      </div>\n    </Fragment>\n  );\n};\n\nexport default Recipe;\n","const recipesCtx = require.context('./recipes', false, /.ya?ml$/);\nconst presetsCtx = require.context('./presets', false, /.ya?ml$/);\n\nfunction getName(fn: string): string {\n  return fn.match(/\\/(.*).ya?ml$/)?.[1] ?? '';\n}\n\nexport const RECIPES: Record<string, Record<string, any>> = recipesCtx\n  .keys()\n  .reduce((acc, cur) => ({ ...acc, [getName(cur)]: recipesCtx(cur) }), {});\n\nexport const PRESETS: Record<string, Record<string, any>> = presetsCtx\n  .keys()\n  .reduce((acc, cur) => ({ ...acc, [getName(cur)]: presetsCtx(cur) }), {});\n","var map = {\n\t\"./ubuntu.yaml\": \"hFeo\"\n};\n\n\nfunction webpackContext(req) {\n\tvar id = webpackContextResolve(req);\n\treturn __webpack_require__(id);\n}\nfunction webpackContextResolve(req) {\n\tif(!__webpack_require__.o(map, req)) {\n\t\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\t\te.code = 'MODULE_NOT_FOUND';\n\t\tthrow e;\n\t}\n\treturn map[req];\n}\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = \"zBN9\";"],"sourceRoot":""}